Pre-requisites
- Create a seperate Key pair for testing
- Download the pem key file
- Upload the pem file to ~/.ssh/ on the jumpbpx
- chmod 600 ~/.ssh/*.pem   https://www.linuxtopia.org/online_books/introduction_to_linux/linux_The_chmod_command.htm

Chmod Command	Meaning       chmod u+rwx,go-rwx file
*chmod 400 file	    To protect a file against accidental overwriting.
chmod 500 directory	To protect yourself from accidentally removing, renaming or moving files from this directory.
*chmod 600 file	    A private file only changeable by the user who entered this command.
chmod 644 file	    A publicly readable file that can only be changed by the issuing user.
chmod 660 file	    Users belonging to your group can change this file, others don't have any access to it at all.
chmod 700 file	    Protects a file against any access from other users, while the issuing user still has full access.
chmod 755 directory	For files that should be readable and executable by others, but only changeable by the issuing user.
chmod 775 file	    Standard file sharing mode for a group.
chmod 777 file	    Everybody can do everything to this file.

Commands:
# https://unix.stackexchange.com/questions/115838/what-is-the-right-file-permission-for-a-pem-file-to-ssh-and-scp
# https://intellipaat.com/community/43019/how-to-copy-files-from-local-machine-to-my-aws-instance

# On local:
cd ~/.ssh/
aws ec2 create-key-pair --key-name KeyForTDL02 --query 'KeyMaterial' --output text > KeyForTDL02.pem
chmod 400 KeyForTDL02.pem
aws ec2 describe-key-pairs --key-nam KeyForTDL02
scp -i ericho.pem KeyForTDL02.pem  centos@52.65.228.232:/home/centos/.ssh

scp -i ericho.pem KeyForTDL02.pem  centos@52.65.228.232:/home/centos/.ssh

# On jumpbox:
chmod 600 ~/.ssh/KeyForTDL02.pem


Based on previous Terraform code, launch an EC2 instance with below settings:
- Image: centos/Amazon Linux 2 AMI (HVM), SSD Volume Type - ami-0ded330691a314693 (64-bit x86)
- Subnet: public subnet
- Public ip
- Security group:
  allow inbound tcp/80, 443 from 0.0.0.0/0
  allow all traffic from from jumpbox by referring jumpbox SG group id
- install Apache HTTP server using below user data script https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html

https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform/6.3/html/administration_and_configuration_guide/install_the_apache_httpd_in_red_hat_enterprise_linux_with_jboss_eap_6_rpm

https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-centos-7

https://stackoverflow.com/questions/55212032/cant-ssh-into-aws-ec2-instance 

# Amazon Linux 2 AMI (HVM), SSD Volume Type - ami-0ded330691a314693 (64-bit x86)
#!/bin/bash
yum update -y
amazon-linux-extras install -y lamp-mariadb10.2-php7.2 php7.2
yum install -y httpd mariadb-server
systemctl start httpd
systemctl enable httpd
usermod -a -G apache ec2-user
chown -R ec2-user:apache /var/www
chmod 2775 /var/www
find /var/www -type d -exec chmod 2775 {} \;
find /var/www -type f -exec chmod 0664 {} \;
echo "<?php phpinfo(); ?>" > /var/www/html/phpinfo.php

#!/bin/bash
sudo su
yum -y install httpd
echo "<p> My Instance! </p>" >> /var/www/html/index.html
sudo systemctl enable httpd
sudo systemctl start httpd

#!/bin/bash
# install httpd (Linux 2 version)
# sudo su
yum update -y
yum install -y httpd.x86_64
systemctl start httpd.service
systemctl enable httpd.service
echo "Hello World from $(hostname,-f)" > /var/www/html/index.html

- Output: public ip of the VM

- SSH to the new VM and check  httpd is running
  systemctl status httpd
- Try to access http://publicip of the VM

ssh -i ~/.ssh/ericho.pem centos@10.128.1.40
ssh -i ~/.ssh/ericho.pem ec2-user@i-0c25bcea258ed0faa

aws ec2 describe-instance-attribute --instance-id i-06b3f74aebb0e4e15 --attribute userData \
--output text --query "UserData.Value" | base64 --decode


Challenge:
- Create an Route 53 record demo.dryovnne.net (A record) in ur domain and point to the VM public ip
- Access the web server using DNS name: http://demo.dryovnne.net/
